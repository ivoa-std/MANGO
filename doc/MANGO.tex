\documentclass[11pt,a4paper]{ivoa}
\input tthdefs

\usepackage{array}
\usepackage{tabulary}  % for nicer tables
\usepackage{calc}
\usepackage{placeins}
\setlength\extrarowheight{2pt}

\newcolumntype{L}{>{\centering\arraybackslash}m{3cm}}
\title{Mango: A Component and Association Based Model for representing data for astronomical sources}

% see ivoatexDoc for what group names to use here
\ivoagroup{DM}


% mireille commands
% borrowed from Prov WD - Kristin - own definitions
\definecolor{todocolor}{rgb}{1,1,0.8}
\definecolor{darkred}{rgb}{0.6,0,0}
\definecolor{rose}{rgb}{1.0,0.88,0.88}
\definecolor{darkgrey}{rgb}{0.35,0.35,0.35}
%\newcommand{\TODO}[1]{%
%    \noindent%
%    \textcolor{todocolor}{\sffamily [\textbf{TODO:} #1]}%
%}

\newcommand{\TODO}[1]{%
    \noindent%
    \colorbox{todocolor}{%
            \parbox{0.85\linewidth}{\sffamily \textbf{TODO:}\\
            #1}
    }%
    \vspace{2pt}

}

\newcommand{\note}[1]{%
    \noindent%
    \textcolor{darkgrey}{{\sffamily Note:} \emph{#1}}%
}

\newcommand{\comment}[1]{%
    \noindent%
    \textcolor{red}{{\sffamily Comment:} \emph{#1}}%
}
% end mir commands


\author{François Bonnarel}
\author{Gilles Landais}
\author{Laurent Michel}
\author{Jesus Salgado}
\author{Mireille Louys}
\author{Marco Molinaro}

\editor{Laurent Michel}

% \previousversion[????URL????]{????Concise Document Label????}
\previousversion{This is the first public release}

\begin{document}
\begin{abstract}
The Mango model proposes a flexible way to expose data related to astronomical source objects 
in an interoperable way.
It takes into account the huge diversity of source data in terms of feature description, format and usage.
The Mango model attaches identifiers on astronomical sources and associates to each a flexible 
set of parameters (e.g. observed physical quantities) and other information like e.g. spectra,
time series or preview images.
Parameters are usually made of several columns of a data table.
Additional data products are bound to the source to contribute to the science analysis
and enhance data understanding.
Mango object parameters are built upon classes or extended classes of the IVOA Measure
and Coordinates data models. It also reuse PhotDM and proposes its own classes for the quantities 
that are not covered by the imported models
Associated data can be simple URLs or VO service endpoints.
The roles of both parameters and associated data are qualified by semantic tags

\end{abstract}


\section*{Acknowledgments}

We would like to thank all those who took the time to present their own use cases (INAF, CDS, CFA, ESAC) on which the model has been built.
We would also like to thank all the people having tested Mango on their own data.

\section*{Model Name}
This model was initially named with a very explicit but hard to remember acronym, \texttt{CAB-MSD}
standing for Component and Association Based Model for Source Data.
We decided later to rename it \texttt{Mango} with reference to the inside out Mango
picture used to introduce the model in Groningen. 
As the tradition requires that such unexpected names are acronyms,
let's assume that \texttt{Mango} stands for
Metadata ANnotation for Generic Objects (in astronomy).


\section*{Conformance-related definitions}

The words ``MUST'', ``SHALL'', ``SHOULD'', ``MAY'', ``RECOMMENDED'', and
``OPTIONAL'' (in upper or lower case) used in this document are to be
interpreted as described in IETF standard RFC2119 \citep{std:RFC2119}.

The \emph{Virtual Observatory (VO)} is a
general term for a collection of federated resources that can be used
to conduct astronomical research, education, and outreach.
The \href{http://www.ivoa.net}{International
Virtual Observatory Alliance (IVOA)} is a global
collaboration of separately funded projects to develop standards and
infrastructure that enable VO applications.


\section{Introduction}

Modeling data collected to study astronomical source objects has been a long term concern for the 
DM working group and more generally for the IVOA.
In the past years, there were some proposals to design a global model for sources \citep{wd:jesusdm}
as well as for catalogs \citep{wd:catalog}.
Other proposals, more model-agnostic, were focused on the data annotation in VOTables
\citep{note:stcvot} \citep{note:seb}.
In this case the goal was no longer to design a source model but to provide a complete description of
individual quantities (positions, velocity, fluxes, magnitudes…).
None of these proposals have come to completion.

The source DM issue resurfaced at the spring 2018 Interop in Victoria during an hands-on session
focusing on the tools available to work with VO data models and especially with VO-DML.
The goal of this session was to annotate data from different origins in order to make them
interoperable with each other.
%mir The main concern expressed during this session was not much related to the tools themselves
but indeed to the lack of models for sources.
One of the main concerns outside de tools necessary to workout this notation was the lack of models
for source objects.
This is a big paradox in the VO world: source data which represent the basic building
blocks of astronomers' work, is not modelled.
This paradox can be explained by the fact that the observation of source objects is multi-faceted.
In a general way, the way features for source data are described and organised depends on
the targeted science case.
Principal investigators and archive designers set up the data profile and structure it according
to this goal which varies from one project to another.
Therefore this diversity cannot be served by a single static data model describing a source
item for all possible cases.
Having a global source model would lead to a very complex solution not usable in practice.

This standard proposes to overcome this paradox and presents a template model gathering independent
components from VO existing models together with VO data products and files embedded on demand in a container.
The template supports fine grain association by composing classes as well as coarse grain relations
to data products and files distributed within projects archive.
Mango is not designed to describe what a source is but to help clients to discover and to understand
the quantities available for a particular source instance.
VOtable data mapped on Mango with Mivot (ref) annotations can be consumed quantity 
par quantity instead of column per column.
The way complex quantities are built is  described by Mango but no longer by the clients.

\subsection{Role within the VO Architecture}

\begin{figure}
\centering

% As of ivoatex 1.2, the architecture diagram is generated by ivoatex in
% SVG; copy ivoatex/archdiag-full.xml to archdiag.xml and throw out
% all lines not relevant to your standard.
% Notes don't generally need this.  If you don't copy archdiag.xml,
% you must remove archdiag.svg from FIGURES in the Makefile.

\includegraphics[width=0.9\textwidth]{role_diagram.pdf}
\caption{Architecture diagram for this document}
\label{fig:archdiag}
\end{figure}

Fig.~\ref{fig:archdiag} shows the role this document plays within the
IVOA architecture \citep{2010ivoa.rept.1123A}.


\section{Representing observed astronomical objects : Use Cases and  Requirements}

\subsection{Use Cases}
The following uses-cases have been collected since 2019 from representatives of various astronomical 
missions, archive designers and tools developers.
The contribution was totally open. This gave a good picture of the needs but we do not pretend 
that everything will be supported by this first version.

All the use-cases summarized below are detailed in appendix.

\subsubsection{Gaia}
Gaia mission is producing the largest and more precise 3D map of our galaxy.

A non-exhaustive list of properties required for Gaia use cases would be composed
of:

\begin{itemize}
    \item identifier
    \item sky reference position
    \item proper motion
    \item parallax and distance

    \item source extension
    \item radial velocity
    \item redshift
    \item photometry
    \item date of detection
    \item correlation
    \item multiple detection
\end{itemize}

\subsubsection{Euclid}
Euclid telescope has been designed to unveil some of the questions about the
dark Universe, including dark matter and dark energy, what would include, e.g.
quite accurate measurements of the expansion of the Universe.

\begin{itemize}
    \item identifier
    \item sky position
    \item correlation with other catalogues
    \item photometry (ground + satellite )
    \item morphology class
    \item redshift
    \item photometric redshift
\end{itemize}

\subsubsection{Exoplanets}
Annotation of (exo-)planetary records in catalogues requires some
specific metadata or model.

The use cases identified requires the following metadata:
\begin{itemize}
	\item the degree of confidence in the detection: exoplanets candidates
w.r.t. confirmed ones, plus last update of the record content ;
	\item the method used in the discovery (since it affects the available
stellar system description parameters);
	\item a set of stellar host characteristics (besides sky coordinates):
activity, mass, type,
metallicity, age, some systemic values, like the global RV (radial
velocity) of the system, and so on;
	\item (exo-)planet parameters, like mass, orbital period, orbit's
eccentricity, RV semi-amplitude, time at periastron (for RV detections)
or central transit time (for transit method), longitude of periastron,
and so on.
\end{itemize}


\subsubsection{Morphologically Complex Structures}
The ViaLactea Knowledge Base (VLKB, see \cite{2016SPIE.9913E..0HM}) is a set of data
resources and services built up to study the star formation regions and
processes in the Milky Way. Besides 2-D images and 3-D radial velocity
cubes, the VLKB exposes a bunch of source catalogues.
A model that supports description of such catalogues will need a
way to describe sources with:
\begin{itemize}
	\item non-point-like positions;
	\item extended complex area, possibly as multiple detached areas;
	\item aggregation of sub-parts (that can be heterogeneous).
\end{itemize}


\subsubsection{Chandra Archive}
The Chandra Source Catalog(CSC) is the definitive catalog of serendipitous X-ray sources identified in
publicly released imaging observations obtained by NASA’s ChandraX-ray Observatory (CXO).

The catalog itself consists of approximately 1,700 columns covering properties at the 
individual observation and stacked analysis levels.
Table \ref{tab:chandra_props} summarizes some of the basic catalog properties derived
from standard CSCView queries.

\begin{table}[ht!]
  \tiny
  \begin{tabular}{|p{0.4cm}p{10.0cm}|}
    \hline
    \multicolumn{2}{|l|}{\textbf{Per Source:}} \\
    & \texttt{ Source name } \\
    & \texttt{ Source position and position errors } \\
    & \texttt{ Significance of the source (signal to noise) } \\
    & \texttt{ Likelihood of the source  (True, False, or Marginal detection) } \\
    & \texttt{ Source extent flag } \\
    & \texttt{ Variability flag } \\
    & \texttt{ Spectral variability flag } \\
    & \texttt{ Fluxes and flux errors in ACIS bands b, h, m, s, u } \\
    & \texttt{ Flux and flux error in  HRC band w } \\
    & \texttt{ Hardness ratios and errors for hm, hs, ms colors } \\
    & \texttt{ Short term (intra-obs) variability probability for each band } \\
    & \texttt{ Long term (inter-obs) variability probability for each band } \\
    & \texttt{ Spectral (hardness ratios) variability for each color } \\
    \hline
    \multicolumn{2}{|l|}{\textbf{Per Detection (at the stack level):}} \\
    & \texttt{ Detection ID } \\
    & \texttt{ Detection position and position errors } \\
    & \texttt{ Flux significance of the detection (S/N) } \\
    & \texttt{ Detection likelihood (True, False, or marginal detection?) } \\
    & \texttt{ Source extent code (codification of source extent in different bands) } \\
    & \texttt{ Variability flag } \\
    & \texttt{ Spectral variability flag } \\
    & \texttt{ Fluxes and flux errors in ACIS bands b, h, m, s, u } \\
    & \texttt{ Flux and flux error in  HRC band w } \\
    & \texttt{ Hardness ratios and errors for hm, hs, ms colors } \\
    & \texttt{ Short term (intra-obs) variability probability for each band } \\
    & \texttt{ Long term (inter-obs) variability probability for each band } \\
    & \texttt{ Spectral (hardness ratios) variability probability for each color } \\
    \hline
    \multicolumn{2}{|l|}{\textbf{Per Detection (at the observation level):}} \\
    \multicolumn{2}{|l|}{ Note that source detection is done at the stack level, but properties are estimated for the } \\
    \multicolumn{2}{|l|}{detections at each observation using the detection region from the stack level.} \\
    & \texttt{ Detection ID } \\
    & \texttt{ Detection position and position errors } \\
    & \texttt{ Flux significance of the detection (S/N) } \\
    & \texttt{ Detection likelihood } \\
    & \texttt{ Source extent code (codification of source extent in different bands) } \\
    & \texttt{ Variability code (applies to intra-obs only) } \\
    & \texttt{ Fluxes and flux errors in ACIS bands b, h, m, s, u } \\
    & \texttt{ Flux and flux error in  HRC band w } \\
    & \texttt{ Hardness ratios and errors for hm, hs, ms colors } \\
    & \texttt{ Short term (intra-obs) variability probability for each band } \\
    \hline

  \end{tabular}
  \caption{ Example Chandra Source Catalog Properties }
  \label{tab:chandra_props}

 \end{table}
 
\subsubsection{Vizier catalog archive}
VizieR provides science ready catalogs coming from space agencies or articles and covering number of
different science cases.
Published data encompass a very large set of measures (position, photometry, redshift, source type, etc.)
depending on their origin.
They can result from  observations, simulations, models or catalog compilations.
Individual Vizier tables can contain data all related to one source (e.g. time series of positions or magnitudes) or to a set of sources (one row per source) or a mix of both.

The Mango model must be able to provide a standard representation of most of the metadata contained 
in Vizier query responses, whether native or computed  by the CDS,
simple quantities or associated complex data.
Mango is not meant to replace the current management of the meta-data,
it is a way to make those meta-data understandable for a wide panel of VO-compliant clients.

\subsubsection{Client on (Mark Taylor behalf)}
Right now, the meta-data provided within the VOTable allow clients such Aladin or Topcat to run most 
of the functionalities expected by the user, either for data analysis of plotting.
This information is often guess from UCDs, UTypes or columns name. It can also be given by the user.
Clients have no expectations of working with full model instances but in some cases models 
can help to know how quantities in an input table relate to each other.

In most cases this is for visualisation, e.g.:
\begin{itemize}
    \item what is the sky position for this row
    (what columns contain latitude and longitude, and what sky system are they in)

     \item what +/-ERR error bars should I plot for these points
    (what column is a simple error for column A)

    \item what error ellipses should I plot for these sky positions
    (what columns provide ra\_error, dec\_error, ra\_dec\_corr,
     or how can I derive those from columns that do exist)

    \item where do I get the grid information for a column containing
    a vector of samples so I can label the X axis of a spectrogram
    (what column or parameter contains an axis vector matching
     the sample vectors)

    \item does this table contain sky positions, or HEALPix tiles, or both?
    What's the best way to represent it on the sky?

    \item What is the meaning of such URL found out in a table?s
\end{itemize}

But there are some other places too:
\begin{itemize}
    \item how do I propagate this sky position to a future epoch
    (what columns contain pmra, pmdec, and maybe all the
     associated errors and correlation coefficients)

    \item what is the error ellipse/oid to use for a sky/Cartesian crossmatch
    (what columns provide the relevant errors and, if available,
     correlations)
\end{itemize}

This usage shows that Mango must be designed in a way that individual measurements or quantities
can be easily be identified as such and manipulated independently of the whole instance.

\subsubsection{Xmatch tool }
The basic cross-match of two astronomical tables consists in associating pairs of sources -- one 
from each table -- fulfilling a given angular distance based criterion.
In relational algebra terms, it is a theta-join on a distance predicate.

More generally, a cross-match is the association of sources from different tables given their 
proximity in an astrometric (but also possibly photometric, statistical, ...) parameter
space \citep{2017A&A...597A..89P} .

If proper motions (plus parallax and radial velocities) are available, the cross-match tool 
may propagate the positions of each table to a common epoch.
It may also take into account positional uncertainties to reject the statistically unlikely associations.

In the latter case (cross-match between two tables taking into account positional errors),
the tool needs to be able to retrieve the errors associated to the each position in each table.

UCDs may help in identifying the errors associated to a positional columns as shown in 
table, but this is not sufficient to table with more complex cases based on multi-parameter cases.

\subsection{Requirements}

\subsubsection{Parameters and Associated Data}
From the use-cases' description, two categories of features must provided or foreseen by the projects:

\begin{itemize}
    \item The source \emph{parameters} astronomers will investigate for their science.
          They are measures provided as numerical values or classification tags exposed as
          numbers or simple strings. 
          Usually on measure corresponds to one individual column or one group of columns.
    \item The \emph{Associated data} are generally science ready data-products either from the
          same project, or shared by other projects within the IVOA interoperability framework.
          They bring a complement of information to interpret the source's  parameters under
          study and compare visually (or computationally) the sky neighborhood of detected sources,
          their variation through time or spectral behavior.
          Referencing such datasets by a URI or by a service endpoint already works for many VO products.
          (it has been promoted and recommended in Obscore / Spectrum Dm, . etc for access URIs, and 
          DataLink for service endpoints REFS).
          Associated data can also present a complex structure designed to bring a very advanced context
          of interpretation (CTA model assumptions, energy model for Xray sources, etc. REFS)
          which need to be described in the attachment.
 \end{itemize}
 
\TODO{The associated data item must be simplified and more factual: this is a requirement}
 

\subsubsection{R01: Supported Quantities}
\begin{itemize}
    \item Mango must provide unique source identifiers.
    \item Mango must provide information about the source origin.
    \item Mango must provide modeling classes for both parameters and associated data.
    \item The number of parameters attached to a Mango instance must be free.
    \item The number of associated data attached to a Mango instance must be free.
\end{itemize}

\subsubsection{R02: Properties}

\begin{itemize}
    \item Mango must support explicit classes imported from an IVOA data-model for the most used parameters.
    \item Mango must provide a generic way to support parameters that do not enter the above category.
    \item Mango instances must support multiple instances of the same parameter class.
    \item The presence of any parameter in Mango instances must be optional.
    \item Mango must provide a way to identify the role of each parameter.
    \item  Mango must provide a way to describe the meaning of flags or qualifiers.
    \item The role of each parameter should be machine-readable.
    \item It must be possible to group parameters in a free way.
          This allows to tag quantities with timestamps or a flags.
\end{itemize}

\subsubsection{R03: Associated Data}

\begin{itemize}
    \item Mango must support references to external datasets.
    \item Mango must support references to external services.
    \item Mango must support references to other Mango instances.
    \item Mango instances must support multiple instances of the same associated data class.
    \item The presence of any associated data in Mango instances must be optional.
    \item Mango must provide a way to identify the role of each associated data in
          order to explain which purpose is served when associating this data to the source object.
    \item The role of each associated data should be machine-readable.
 \end{itemize}

\section{Model Overview}

\begin{figure}
    \includegraphics[width=1.0\textwidth]{../model/mangoOverview.png}
    \caption{Mango overview} 
    \label{fig:overview}
\end{figure}


Sky objects are represented by instances of the class \texttt{MangoObject} which has only
one mandatory attribute, an \texttt{identifier}.
It is recommended the identifiers to be unique within a source collection e.g. a catalog.

In addition to the identifier, \texttt{MangoObject}  have 3 components:

\begin{itemize}
  \item \texttt{dataOrigin} giving the origin of the \texttt{MangoObject}. The structure of this class follows
        the recommendations of the DCP IG (time of writing).
  \item \texttt{popertyDock}, the place holder for all the \texttt{MangoObject} properties.
        This is an open-ended collection.
        Each source property is hooked to the \texttt{MangoObject} by a wrapping class (\texttt{Property} )
        that contains anything necessary to identify both its nature and its role.
        Properties can be linked together to represent logical parameter sets. 
        These logical sets have no semantic. Their interpretation is in charge of the clients.
  \item \texttt{associatedDataDock}, the place holder for all external data attached to the \texttt{MangoObject}.
        This is an open-ended collection.
  		Associated data are hooked to the \texttt{associatedDataDock} by a wrapping class (\texttt{AssociatedData})
        that contains anything necessary to identify its nature and its role.
\end{itemize}
\subsection{Properties}

\TODO{describe what properties are}

\subsubsection{Parameters Identification}
As the property set  attached to a particular instance is not defined by Mango,
the model must provide an accurate parameter description to allow the client to figure
out what it can do with each of them.

The role of any parameter can be refined by to semantic specific fields: 
\begin{itemize}
    \item \textbf{Semantic}: A reference to  a valid vocabulary word may be attached to each parameter. 
          The choice of that vocabulary is totally free as long as it is published.
    \item \textbf{Description}: A free text description may be attached to each parameter.
\end{itemize}

In addition this, some Quantity classes have their own qualifiers such as the calibration level.

\TODO{The commented tables must be updated and possibly merged}

%\TODO{TBC phys.luminosity  vs phot.flux}
%
%\begin{table}[!htbp]
%\small
%\centering
%\begin{tabulary}{\linewidth}{|L|C|J|}
 %      \hline Parameter &  Original model & UCDs 1+ first word  \\
 %      \hline  \texttt{GenericMeasure}             &  Measure  &   Appropriate UCD \ \\
 %      \hline  \texttt{Position}             &  Measure  &  pos.* \\
 %      \hline  \texttt{Velocity  }            &  Measure & phys.veloc      \\
 %      \hline  \texttt{Proper motion}    & Measure & pos.pm    \\
 %      \hline  \texttt{Time}                   & Measure &  time.epoch   \\
 %      \hline  \texttt{Polarization}         & Measure & phys.polarization \\
 %      \hline  \texttt{EpochPosition}    &  Mango  &  pos.eq \\
 %      \hline  \texttt{Redshift}                        &  Mango  & src.redshift \\
 %      \hline  \texttt{Photometry}                    &  Mango  & phot.* \\
  %     \hline  \texttt{Color}             &  Mango  & phot.flux;arith.ratio \\
  %     \hline  \texttt{Shape}                     &  Mango  & phys.area \\
%       \hline  \texttt{Flag}                        &  Mango  & meta.code  \\
%       \hline  \texttt{Status}                        &  Mango  & meta.code  \\
%       \hline
%     \end{tabulary}
%     \caption{ UCDs space to be used for the supported measures}
%     \label{tab:ucds}
% \end{table}

\begin{figure}
     \includegraphics[width=1.0\textwidth]{../model/property.png}
     \caption{Measure/Coordinate pattern (simplified view)}
     \label{fig:properties}
\end{figure}

\begin{figure}
  \includegraphics[width=1.0\textwidth]{../model/MangoDataOrigin.png}
  \caption{Mango extensions of Measure.}
  \label{fig:dataOrigin}
\end{figure}

\begin{figure}
  \includegraphics[width=1.0\textwidth]{../model/mangoErrorTypes.png}
  \caption{Mango correlated errors.}
  \label{fig:errors}
\end{figure}

\begin{figure}
  \includegraphics[width=1.0\textwidth]{../model/correlation.png}
  \caption{Mango correlations.}
  \label{fig:correlation}
\end{figure}

\begin{figure}
  \includegraphics[width=1.0\textwidth]{../model/mangoEpochPosition.png}
  \caption{Mango correlated errors.}
  \label{fig:epochPosition}
\end{figure}



%\begin{table}[ht!]
 %    \tiny
%     \begin{tabular}{|p{2.4cm}|p{1.8cm}|p{7cm}|}
%       \hline Quantity &  Model &  \\
%       \hline  \texttt{identifier}      & Mango & required for anu instance\\
%       \hline  \texttt{position}      &  Meas &  \\
%       \hline  \texttt{pr. motion}   & Meas &     \\
%       \hline  \texttt{distance}     & Ext Meas &     \\
%       \hline  \texttt{correlation}   & Ass data & reference to other Mango instances     \\
%       \hline  \texttt{extension}     & Ext Meas & Can be used for FoV, morphlogy or shape\\
%       \hline  \texttt{rad. vel.}       &  Ext Meas  &       \\
 %      \hline  \texttt{redshift}        &   Ext Meas  &  \\
%       \hline  \texttt{phot. rsft}      & Ext Meas&    \\
%       \hline  \texttt{luminosity}    & Ext Meas&\\
 %      \hline  \texttt{date}             & Meas & date or time stamp\\
 %      \hline  \texttt{detections}    & Ass data & reference to other Mango instances   \\
 %      \hline  \texttt{orbit}             & Ext Meas&      \\
 %      \hline  \texttt{type}             &Ext Meas&     \\
 %      \hline  \texttt{status}          &Ext Meas&     \\
 %      \hline  \texttt{orb. sys.}      &Ext Meas&     \\
 %      \hline  \texttt{PHA}            &Ext Meas&     \\
 %      \hline  \texttt{ass. prd.}     &Ass data&  \\
 %      \hline
%     \end{tabular}
 %    \caption{ Mango quantities with  corresponding complex type  \texttt{Native Meas} Measure class, \texttt{Ext Meas } Measure extension, \texttt{Ass data  } Mango associated data}
% \end{table}



\subsection{Associated Data}

\texttt{AssociatedData} connectors are used to bind various sort of complex data with the Mango object.
One connector can only refer to one dataset.
Associated data can be either URIs (VO services or not) or other mango instances.

\subsubsection{AssociatedData Identification}
As the associated data set  attached to a particular instance is not defined by Mango,
the model must provide an accurate parameter description to allow the client to figure out what it can do with each of them.
Mango provides 3 description levels for each category of associated data:

\begin{itemize}
    \item \textbf{Data class (vodml type)}: Knowing the class representing associated data
          tells the clients  how to interpret it but does help to get its role.
    \item \textbf{Semantic}: A reference to  a valid vocabulary word may be attached to
          each associated data set.
          The choice of that vocabulary is totally free as long as it is published.
    \item \textbf{Description}: A free text description may be attached to each associated data .
\end{itemize}


\input{model.tex}

\TODO{must be updated and simplified}
\section{TAP and Mango}
This not normative section gives possible tips to save and discover Mango instances in TAP services.
We suppose that the TAP service hosts catalogs which sources are Mango instances. These catalogs are named \emph{Mango Catalogs}.

\subsection{Storing Mango Catalogs in TAP}
For now this section only concerns the parameter. The associated data will be taken into account later.

\begin{itemize}
  \item One master table for the catalogs with various meta-data out of the Mango scope plus a unique identifier (primary key)
  \item One master sources table for the source instances with the catalog identifier and a primary key safer than the Mango identifier.
  \item One table for each supported parameter with a foreign key for the join with the master source table
\end{itemize}

Although the model of the measures is hierarchical, it should be possible to flatten them in one single table considering that the model structure can be retrieved with the TAP\_SCHEMA annotations (TBC)

This schema requires the server to explore all the parameter tables to retrieve  whole Mango instances. This process can be speed up by using the \emph{MangoCore} table.

\subsection{ \emph{MangoCore} Table}

The discovery of \emph{Mango Catalogs} can be helped by a  \emph{MangoCore} table located in the  \emph{schema} schema. As Mango is not dedicated to any specific domain, we cannot define a set of core parameters, but parameters can be flagged as \emph{Core Parameter}. This selection is left at the discretion of the curator.
The \emph{MangoCore} table has set of columns per parameter class plus one for the catalog ID. It has one row per stored catalog. Each parameter has at least 2 columns: one with the UCD and one with the \emph{Core} flag. TBC


\appendix

\section{Gaia}
\input{usecase_gaia.tex}

\section{Euclid}
\input{usecase_euclid.tex}

\section{Chandra Archive}
\input{usecase_chandra.tex}

\section{Vizier}
\input{usecase_vizier.tex}

\section{Morphologically Complex Structures}
\input{usecase_complex_structures.tex}

\section{Exoplanets}
\input{usecase_exoplanets.tex}

\subsubsection{Client on (MT behalf)}
\input{usecase_client_side.tex}

\section{Xmatch tool }
\input{usecase_xmatch.tex}

\section{Imported Models Instance}

\section{Changes from Previous Versions}

No previous versions yet.
% these would be subsections "Changes from v. WD-..."
% Use itemize environments.


% NOTE: IVOA recommendations must be cited from docrepo rather than ivoabib
% (REC entries there are for legacy documents only)
\bibliography{ivoatex/docrepo,MANGO}


\end{document}
